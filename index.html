<!DOCTYPE html>
<html>
<head>
    <title>DIDComm Query (Alice to Bob)</title> <!-- Set the title of the web page -->
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <h1>DIDComm Query</h1> <!-- Display a heading on the web page -->
    
    <!-- Add an input element for message content -->
    <input type="text" id="messageContent" placeholder="Enter your message" value="SELECT D.* FROM DUAL D;">
    
    <!-- Create a button element with an ID for calling the combined API actions -->
    <button id="callApiButton">Send query</button>
    
    <!-- Create a div element with an ID for displaying the API response -->
    <div id="apiResponse"></div>

    <!-- Include an external JavaScript file "app.js" -->
    <script src="app.js"></script>

    <script>
        const callApiButton = document.getElementById("callApiButton");
        const apiResponse = document.getElementById("apiResponse");
        const messageContentInput = document.getElementById("messageContent"); // Get the message input element

        callApiButton.addEventListener("click", async () => {
            try {
                const messageContent = messageContentInput.value; // Get the content from the input

                // Step 1: Send an HTTP GET request to "http://localhost:3200/create-invitation" with the message content
                const createInvitationResponse = await fetch(`http://localhost:3200/create-invitation`);
                console.log("Create Invitation Response: " + createInvitationResponse.data);

                // Parse the JSON response for creating an invitation
                const invitationData = await createInvitationResponse.json();

                // Introduce a 1-second delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Step 2: Send an HTTP GET request to "http://localhost:3200/hardcoded-connection-msg" with the message content
                const sendHardcodedMsgResponse = await fetch(`http://localhost:3200/hardcoded-connection-msg?messageContent=${messageContent}`);

                // Parse the JSON response for sending a hardcoded message
                const sendHardcodedMsgData = await sendHardcodedMsgResponse.json();

                // Append the response of sending the hardcoded message to the previous response
                apiResponse.innerHTML += JSON.stringify(sendHardcodedMsgData);

                // Show the #apiResponse element
                apiResponse.style.display = "block";
            } catch (error) {
                // Handle errors: display an error message in the div
                apiResponse.innerHTML = "Error: " + error.message;
            }
        });
    </script>
</body>
</html>
